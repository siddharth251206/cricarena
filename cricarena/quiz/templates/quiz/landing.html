{% extends 'quiz/page.html' %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'quiz/style.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<div class="start-container">
  <h1>Welcome to the Cricket Quiz Arena 🏏</h1>
  <p>Test your cricket knowledge and climb the leaderboard!</p>

  {% if user.is_authenticated %}
  <form id="quizStartForm" method="POST" action="{% url 'start_quiz' %}">
  {% csrf_token %}
  <label for="difficulty">Choose Difficulty:</label>
  <select name="difficulty" id="difficulty" required>
    <option value="" disabled selected>-- Select --</option>
    <option value="easy">Easy</option>
    <option value="medium">Medium</option>
    <option value="hard">Hard</option>
  </select>
  <button type="submit" id="startQuizBtn">Start Quiz 🚀</button>
</form>
<div class="modal-overlay" id="quizInfoModal" style="display: none;">
  <div class="modal-box">
    <button class="modal-close" onclick="document.getElementById('quizInfoModal').style.display='none'">✕</button>
    <h3>Before You Begin</h3>
    <ul>
      <li>All 10 questions(MCQs) must be answered to submit your quiz.</li>
      <li>Exclusive achievements unlock based on your final score.</li>
      <li>Real-time leaderboard updates track your ranking instantly.</li>
      <li>Receive a comprehensive performance analysis upon completion.</li>
    </ul>
    <button id="confirmStartBtn">Start Challenge 🏏</button>
  </div>
</div>

  {% else %}
   <a href="/accounts/?next={% url 'quiz_home' %}" class="btn btn-primary">Login to Start Quiz</a>
  {% endif %}

  <!-- Inside landing.html -->
  <a href="{% url 'poll_list' %}" class="explore-polls-btn" data-page="Fan Polls">🗳️ Explore Fan Polls</a>
  <a href="{% url 'leaderboard' %}" class="leaderboard-btn" data-page="Leaderboard">🏆 View Leaderboard</a>
 <div id="page-loader" class="hide"> <!-- start hidden off-screen right -->
  <div class="loader-content">
    <div class="logo-container">
      <img src="/static/ipl/assets/cricarenalogo.png" alt="CRICARENA Logo" class="loader-logo">

      <div class="orbit orbit1"><div class="orbit-ball"></div></div>
      <div class="orbit orbit2"><div class="orbit-ball"></div></div>
      <div class="orbit orbit3"><div class="orbit-ball"></div></div>
      <div class="orbit orbit4"><div class="orbit-ball"></div></div>
      <div class="orbit orbit5"><div class="orbit-ball"></div></div>
      <div class="orbit orbit6"><div class="orbit-ball"></div></div>
    </div>

    <div class="loader-text">Loading <span id="next-page-name">...</span></div>
  </div>
</div>

</div>
{% endblock %}
{% block scripts_extra %}
 <script>
  document.documentElement.classList.add("js-loader-ready");
</script>
<script>
  const startBtn = document.getElementById('startQuizBtn');
  const modal = document.getElementById('quizInfoModal');
  const confirmBtn = document.getElementById('confirmStartBtn');
  const form = document.getElementById('quizStartForm');

  startBtn.addEventListener('click', function (e) {
    e.preventDefault();
    const difficulty = document.getElementById('difficulty').value;
    if (!difficulty) {
      alert("Please select a difficulty level first!");
      return;
    }
    modal.style.display = 'flex';
  });

  confirmBtn.addEventListener('click', function () {
    modal.style.display = 'none';
    form.submit();
  });
  const loader = document.getElementById("page-loader");
const nextPageName = document.getElementById("next-page-name");

// Mark page as JS-ready so CSS flex works
document.documentElement.classList.add("js-loader-ready");

// Handle link clicks for forward navigation
document.querySelectorAll("a").forEach(link => {
  if (
    link.hostname === window.location.hostname &&
    link.getAttribute("href") &&
    !link.href.includes("#")
  ) {
    link.addEventListener("click", e => {
      if (e.ctrlKey || e.metaKey || link.target === "_blank") return;

      e.preventDefault();

      // Set loading page name
      const pageName = link.getAttribute("data-page") || link.textContent.trim() || "Loading";
      nextPageName.textContent = pageName;

      // Show loader animation
      loader.classList.remove("hide");
      loader.classList.add("active");

      // Navigate after short delay
      setTimeout(() => {
        window.location.href = link.href;
      }, 500);
    });
  }
});

// On page load
window.addEventListener("load", () => {
  setTimeout(() => {
    loader.classList.add("hide");
    loader.classList.remove("active");
  }, 300);
});

// Detect browser back/forward and disable animation
window.addEventListener("pageshow", (event) => {
  if (
    event.persisted ||
    performance.getEntriesByType("navigation")[0]?.type === "back_forward"
  ) {
    loader.style.transition = "none"; // kill animation
    loader.classList.add("hide");
    loader.classList.remove("active");
    // Restore animation for future forward nav
    requestAnimationFrame(() => {
      loader.style.transition = "";
    });
  }
});

</script>
{% endblock %}